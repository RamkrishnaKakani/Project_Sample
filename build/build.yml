trigger:
  branches:
    include:
      - development
      - master
  paths:
    include:
     - source/*
pr:
  branches:
    include:
      - development
      - master
      - Feature_*
      - feature_*
  paths:
    include:
     - source/*

resources:
  repositories:
    - repository: CMTeam
      type : github
      endpoint: MyGithubServiceConnection
      name: RamkrishnaKakani/CMTeam
      ref : master
      
variables:
  solution: '**/HelloWorld.sln'
  env : 'dev'
  project : 'todobyram'
  version : '001'
  TerraformApply : True

  ${{ if in(variables['Build.Reason'], 'Manually Triggered') }}:
    TerraformDestroy : True
    TerraformApply : False

stages:
- stage: DotNetCompliation
  pool:
    vmImage: 'windows-latest'
  jobs:
  - job :
    steps:
    - task: NuGetToolInstaller@1
    - task: NuGetCommand@2
      displayName: 'Run Nuget Restore'
      inputs:
        command: 'restore'
        restoreSolution: '$(solution)'

    - task: DotNetCoreCLI@2
      displayName: Publish Solution
      inputs:
        command: 'publish'
        publishWebProjects: true
        projects: $(solution)
        arguments: '--configuration Release /p:DebugType=None /p:DebugSymbols=false --output $(Build.SourcesDirectory)\build\zip\Project_Sample -v d'
        modifyOutputPath: false
        zipAfterPublish: true
        workingDirectory: '$(Build.SourcesDirectory)'
      condition: and(succeeded(), in(variables['Build.Reason'], 'IndividualCI', 'PullRequest'))

    - task: PublishBuildArtifacts@1
      displayName: Publish zip file
      inputs:
        PathtoPublish: '$(Build.SourcesDirectory)\build\zip\Project_Sample'
        ArtifactName: 'drop'
        publishLocation: 'Container'
      condition: and(succeeded(), in(variables['Build.Reason'], 'IndividualCI', 'PullRequest'))
    
    - task: PowerShell@2
      displayName: 'Trigger For Release Pipline'
      inputs:
        targetType: 'inline'
        script: 'Write-Host "##vso[build.addbuildtag]trigger"'
      condition: and(succeeded(), in(variables['Build.Reason'], 'IndividualCI', 'PullRequest'))

    - task: PowerShell@2
      displayName: 'Try1'
      inputs:
        targetType: 'inline'
        script: 'Write-Host "Hello"'
      condition: and(succeeded(), in(variables['Build.Reason'], 'Manually Triggered'))
    