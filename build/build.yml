trigger:
  branches:
    include:
      - development
      - master
  paths:
    include:
     - source/*
pr:
  branches:
    include:
      - development
      - master
      - Feature_*
      - feature_*
  paths:
    include:
     - source/*

resources:
  repositories:
    - repository: CMTeam
      type : github
      endpoint: MyGithubServiceConnection
      name: RamkrishnaKakani/CMTeam
      ref : master
      
variables:
  solution: '**/HelloWorld.sln'

stages:
- stage: DotNetCompliation
  pool:
    vmImage: 'windows-latest'
  jobs:
  - job :
    steps:
    - task: NuGetToolInstaller@1
      displayName: 'Install Dependancies'
      #condition: and(succeeded(), in(variables['Build.Reason'], 'IndividualCI', 'PullRequest'))

    - task: NuGetCommand@2
      displayName: 'Run Nuget Restore'
      inputs:
        command: 'restore'
        restoreSolution: '$(solution)'
      #condition: and(succeeded(), in(variables['Build.Reason'], 'IndividualCI', 'PullRequest'))

    - task: DotNetCoreCLI@2
      displayName: Publish Solution
      inputs:
        command: 'publish'
        publishWebProjects: true
        projects: $(solution)
        arguments: '--configuration Release /p:DebugType=None /p:DebugSymbols=false --output $(Build.SourcesDirectory)\build\zip\Project_Sample -v d'
        modifyOutputPath: false
        zipAfterPublish: true
        workingDirectory: '$(Build.SourcesDirectory)'
      #condition: and(succeeded(), in(variables['Build.Reason'], 'IndividualCI', 'PullRequest'))

    - task: PublishBuildArtifacts@1
      displayName: Publish zip file
      inputs:
        PathtoPublish: '$(Build.SourcesDirectory)\build\zip\Project_Sample'
        ArtifactName: 'drop'
        publishLocation: 'Container'
      #condition: and(succeeded(), in(variables['Build.Reason'], 'IndividualCI', 'PullRequest'))
    